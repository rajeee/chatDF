@tailwind base;
@tailwind components;
@tailwind utilities;

/* Implements: spec/frontend/plan.md#theme-implementation
   Semantic color tokens mapped per light/dark theme. */

@layer base {
  :root {
    --color-bg: #f9fafb;
    --color-surface: #ffffff;
    --color-text: #111827;
    --color-text-secondary: #6b7280;
    --color-border: #e5e7eb;
    --color-accent: #2563eb;
    --color-accent-hover: #1d4ed8;
    --color-error: #dc2626;
    --color-warning: #d97706;
    --color-success: #10b981;
    --color-info: #3b82f6;
    --color-white: #ffffff;
    --color-shadow: rgba(0, 0, 0, 0.08);
    --color-backdrop: rgba(0, 0, 0, 0.5);

    /* Syntax highlighting (light theme) */
    --syntax-keyword: #a626a4;
    --syntax-string: #50a14f;
    --syntax-number: #986801;
    --syntax-comment: #a0a1a7;
    --syntax-operator: #4078f2;
  }

  /* Smooth scrolling for better UX */
  html {
    scroll-behavior: smooth;
  }

  .dark {
    --color-bg: #111827;
    --color-surface: #1f2937;
    --color-text: #f9fafb;
    --color-text-secondary: #9ca3af;
    --color-border: #374151;
    --color-accent: #60a5fa;
    --color-accent-hover: #93bbfd;
    --color-error: #f87171;
    --color-warning: #fbbf24;
    --color-success: #34d399;
    --color-info: #60a5fa;
    --color-white: #ffffff;
    --color-shadow: rgba(0, 0, 0, 0.3);
    --color-backdrop: rgba(0, 0, 0, 0.5);

    /* Syntax highlighting (dark theme) */
    --syntax-keyword: #c678dd;
    --syntax-string: #98c379;
    --syntax-number: #d19a66;
    --syntax-comment: #5c6370;
    --syntax-operator: #56b6c2;
  }
}

/* Theme transition — smooth cross-fade applied only during theme switch.
   The useTheme hook should add/remove .theme-transitioning class. */
html.theme-transitioning,
html.theme-transitioning *,
html.theme-transitioning *::before,
html.theme-transitioning *::after {
  transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease !important;
}

/* Message appear animation */
@keyframes messageSlideIn {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.message-appear {
  animation: messageSlideIn 0.3s ease-out forwards;
}

/* Typing indicator animation - smooth pulsing dots */
@keyframes typingPulse {
  0%, 60%, 100% {
    opacity: 0.3;
    transform: scale(0.8);
  }
  30% {
    opacity: 1;
    transform: scale(1);
  }
}

.typing-dot {
  display: inline-block;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background-color: currentColor;
  animation: typingPulse 1.4s ease-in-out infinite;
}

.typing-dot:nth-child(1) {
  animation-delay: 0s;
}

.typing-dot:nth-child(2) {
  animation-delay: 0.2s;
}

.typing-dot:nth-child(3) {
  animation-delay: 0.4s;
}

/* Streaming cursor — pulsing caret at end of streaming text */
@keyframes streamingCursorPulse {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.3;
  }
}

.streaming-cursor {
  display: inline-block;
  width: 2px;
  height: 1.1em;
  vertical-align: text-bottom;
  margin-left: 1px;
  background-color: var(--color-accent);
  border-radius: 1px;
  animation: streamingCursorPulse 1s ease-in-out infinite;
}

/* Skip-to-content link: visually hidden until focused */
.skip-to-content {
  position: absolute;
  top: -100%;
  left: 16px;
  z-index: 9999;
  padding: 8px 16px;
  border-radius: 0 0 6px 6px;
  font-size: 14px;
  font-weight: 500;
  text-decoration: none;
  color: var(--color-white);
  background-color: var(--color-accent);
  transition: top 0.15s ease;
}

.skip-to-content:focus {
  top: 0;
  outline: 2px solid var(--color-accent);
  outline-offset: 2px;
}

/* Focus-visible outlines for keyboard navigation.
   Shows a consistent accent-colored ring ONLY when using keyboard (Tab/Shift+Tab),
   not on mouse click. Covers buttons, links, inputs, selects, textareas. */
*:focus-visible {
  outline: 2px solid var(--color-accent);
  outline-offset: 2px;
}

/* Inputs and textareas get a ring instead of outline for cleaner look */
input:focus-visible,
textarea:focus-visible,
select:focus-visible {
  outline: none;
  box-shadow: 0 0 0 2px var(--color-accent);
}

/* Prompt chip: interactive hover with lift & glow */
.prompt-chip {
  transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
  border: 1px solid transparent;
}

.prompt-chip:hover {
  transform: translateY(-2px) scale(1.03);
  box-shadow: 0 4px 12px var(--color-shadow);
  border-color: var(--color-accent);
}

.prompt-chip:active {
  transform: translateY(0) scale(0.98);
  box-shadow: none;
}

/* Gentle floating animation for empty-state icons */
@keyframes gentleFloat {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-6px);
  }
}

.empty-state-float {
  animation: gentleFloat 3s ease-in-out infinite;
}

/* Onboarding fade-in for content sections */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.animate-fade-in {
  animation: fadeIn 0.15s ease-out;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(12px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.onboarding-fade-in {
  animation: fadeInUp 0.5s ease-out forwards;
}

.onboarding-fade-in-delayed {
  opacity: 0;
  animation: fadeInUp 0.5s ease-out 0.15s forwards;
}

.onboarding-fade-in-delayed-2 {
  opacity: 0;
  animation: fadeInUp 0.5s ease-out 0.3s forwards;
}

/* Exit animation for SuggestedPrompts / OnboardingGuide when first message is sent */
@keyframes fadeOutUp {
  from {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
  to {
    opacity: 0;
    transform: translateY(-16px) scale(0.97);
  }
}

.onboarding-exit {
  animation: fadeOutUp 0.3s ease-in forwards;
  pointer-events: none;
}

/* First message entrance — slightly more dramatic than normal message-appear */
@keyframes firstMessageSlideIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.first-message-entrance {
  animation: firstMessageSlideIn 0.4s ease-out 0.15s both;
}

/* Modal entrance animations — scale + fade for a polished feel */
@keyframes modalBackdropIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes modalScaleIn {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.modal-backdrop-enter {
  animation: modalBackdropIn 0.2s ease-out forwards;
}

.modal-scale-enter {
  animation: modalScaleIn 0.2s ease-out forwards;
}

/* Stagger entrance animation for dataset cards.
   Uses --stagger-index custom property set inline for per-card delay. */
.dataset-card-enter {
  opacity: 0;
  animation: fadeInUp 0.35s ease-out forwards;
  animation-delay: calc(var(--stagger-index, 0) * 60ms);
}

/* Exit animation for dataset cards when removed */
@keyframes datasetCardExit {
  from {
    opacity: 1;
    transform: translateX(0) scale(1);
    max-height: 100px;
  }
  to {
    opacity: 0;
    transform: translateX(20px) scale(0.95);
    max-height: 0;
    padding-top: 0;
    padding-bottom: 0;
    margin-top: 0;
    margin-bottom: 0;
    overflow: hidden;
  }
}

.dataset-card-exit {
  animation: datasetCardExit 0.25s ease-in forwards;
  pointer-events: none;
}

/* Syntax highlighting classes for code blocks */
.syntax-keyword { color: var(--syntax-keyword, #a626a4); }
.syntax-string { color: var(--syntax-string, #50a14f); }
.syntax-number { color: var(--syntax-number, #986801); }
.syntax-comment { color: var(--syntax-comment, #a0a1a7); font-style: italic; }
.syntax-operator { color: var(--syntax-operator, #4078f2); }

/* Ensure inline code wraps in message bubbles */
.prose code {
  overflow-wrap: anywhere;
  word-break: break-all;
}

/* Ensure pre blocks scroll horizontally instead of overflowing */
.prose pre {
  overflow-x: auto;
  max-width: 100%;
}

/* Hide number-input spin buttons for clean inline page-jump input */
.hide-spin-buttons::-webkit-inner-spin-button,
.hide-spin-buttons::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
.hide-spin-buttons {
  -moz-appearance: textfield;
}

/* Touch device support: show action buttons that are normally hover-only.
   On devices without hover (phones, tablets), these buttons would be permanently
   invisible since there's no hover state. Show them at subtle opacity instead. */
@media (hover: none) {
  .touch-action-btn {
    opacity: 0.5 !important;
  }
}

/* Safe-area insets for notched phones (iPhone X+).
   Uses env() with fallback to 0px for non-notched devices. */
@supports (padding: env(safe-area-inset-top)) {
  .safe-area-top {
    padding-top: env(safe-area-inset-top, 0px);
  }
  .safe-area-bottom {
    padding-bottom: env(safe-area-inset-bottom, 0px);
  }
  .safe-area-left {
    padding-left: env(safe-area-inset-left, 0px);
  }
  .safe-area-right {
    padding-right: env(safe-area-inset-right, 0px);
  }
}

/* Respect prefers-reduced-motion: reduce or disable animations.
   - Transform/slide animations → instant (0.01s to still fire animationend)
   - Informational animations (cursor pulse) → reduced but kept
   - Hover lift effects → disabled */
@media (prefers-reduced-motion: reduce) {
  .message-appear,
  .first-message-entrance,
  .onboarding-fade-in,
  .onboarding-fade-in-delayed,
  .onboarding-fade-in-delayed-2,
  .onboarding-exit,
  .modal-backdrop-enter,
  .modal-scale-enter,
  .dataset-card-enter,
  .dataset-card-exit,
  .animate-fade-in {
    animation-duration: 0.01s !important;
    animation-delay: 0s !important;
  }

  .typing-dot {
    animation: none !important;
    opacity: 0.6;
  }

  .empty-state-float {
    animation: none !important;
  }

  .streaming-cursor {
    animation-duration: 2s !important;
  }

  .prompt-chip:hover {
    transform: none !important;
    box-shadow: none !important;
  }

  .prompt-chip:active {
    transform: none !important;
  }

  /* Disable transition-based motion */
  .skip-to-content {
    transition-duration: 0.01s !important;
  }

  html.theme-transitioning,
  html.theme-transitioning *,
  html.theme-transitioning *::before,
  html.theme-transitioning *::after {
    transition: none !important;
  }
}
